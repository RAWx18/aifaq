

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Considerations for getting to v2.x &mdash; Hyperledger Fabric Docs main documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=c3038dac" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=a8da1a53"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Upgrading your components" href="upgrading_your_components.html" />
    <link rel="prev" title="Upgrading to the latest release" href="upgrade.html" /> 
<script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="hyperledger-fabric" /><meta name="readthedocs-version-slug" content="release-2.5" /><meta name="readthedocs-resolver-filename" content="/upgrade_to_newest_version.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


          
          
          <a href="index.html" class="icon icon-home">
            Hyperledger Fabric Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://discord.com/invite/hyperledger"><img style="padding: 0px; margin: auto auto auto auto;" alt="Discord" src="_static/images/discord_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="_static/images/youtube_button.png"/></a>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What’s new in Hyperledger Fabric v2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started - Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_run_fabric.html">Getting Started - Run Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_guide_overview.html">Deploying a production network</a></li>
<li class="toctree-l1"><a class="reference internal" href="ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="upgrade.html">Upgrading to the latest release</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Considerations for getting to v2.x</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#upgrading-from-a-prior-v2-x-release-to-the-v2-5-lts-release">Upgrading from a prior v2.x release to the v2.5 LTS release.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrading-from-v1-4-x-release-to-a-v2-x-release">Upgrading from v1.4.x release to a v2.x release</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prior-to-upgrading-peer-nodes">Prior to upgrading peer nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#while-upgrading-peer-nodes">While upgrading peer nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#after-upgrading-nodes">After upgrading nodes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="upgrading_your_components.html">Upgrading your components</a></li>
<li class="toctree-l2"><a class="reference internal" href="updating_capabilities.html">Updating the capability level of a channel</a></li>
<li class="toctree-l2"><a class="reference internal" href="enable_cc_lifecycle.html">Enabling the new chaincode lifecycle</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Hyperledger Fabric Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="upgrade.html">Upgrading to the latest release</a></li>
      <li class="breadcrumb-item active">Considerations for getting to v2.x</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/upgrade_to_newest_version.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="considerations-for-getting-to-v2-x">
<h1>Considerations for getting to v2.x<a class="headerlink" href="#considerations-for-getting-to-v2-x" title="Link to this heading">¶</a></h1>
<p>In this topic we’ll cover recommendations for upgrading from a prior v2.x release to the v2.5 long-term support (LTS) release, as well as from the v1.4 release.</p>
<section id="upgrading-from-a-prior-v2-x-release-to-the-v2-5-lts-release">
<h2>Upgrading from a prior v2.x release to the v2.5 LTS release.<a class="headerlink" href="#upgrading-from-a-prior-v2-x-release-to-the-v2-5-lts-release" title="Link to this heading">¶</a></h2>
<p>Upgrading nodes from a prior v2.x release to the v2.5 LTS release requires no special considerations, simply follow the steps in <a class="reference external" href="./upgrading_your_components.html">Upgrading your components</a>. Upon the first start each v2.5 peer will rebuild some internal indexes for managing private data.</p>
<p>The 2.5 release featured one new application capability:</p>
<ul class="simple">
<li><p><strong>Application</strong> capability <code class="docutils literal notranslate"><span class="pre">V2_5</span></code> enables purging the history of private data from a peer while preserving a hash of the private data as immutable evidence on the blockchain as described in the <a class="reference external" href="./private-data/private-data.html#purging-private-data-in-chaincode">Purging private data</a> concept topic.</p></li>
</ul>
<p>If you would like to take advantage of the new feature, make sure to upgrade your peer binaries before updating the <strong>Application</strong> capability to <code class="docutils literal notranslate"><span class="pre">V2_5</span></code>. If you do not need the new feature, the <strong>Application</strong> capability can remain at <code class="docutils literal notranslate"><span class="pre">V2_0</span></code>.</p>
<p>For information about how to set new capabilities, check out <a class="reference external" href="./updating_capabilities.html">Updating the capability level of a channel</a>.</p>
</section>
<section id="upgrading-from-v1-4-x-release-to-a-v2-x-release">
<h2>Upgrading from v1.4.x release to a v2.x release<a class="headerlink" href="#upgrading-from-v1-4-x-release-to-a-v2-x-release" title="Link to this heading">¶</a></h2>
<p>Before attempting to upgrade from v1.4.x to v2.x, make sure to consider the following before, during, and after your peer upgrades.</p>
<section id="prior-to-upgrading-peer-nodes">
<h3>Prior to upgrading peer nodes<a class="headerlink" href="#prior-to-upgrading-peer-nodes" title="Link to this heading">¶</a></h3>
<p>It is important to ensure chaincode utilizes good practices consistent with v2.x prior to upgrading nodes and enabling the new chaincode lifecycle.
Consider updating chaincode based on the below guidelines prior to upgrading nodes.</p>
<section id="chaincode-shim-changes-go-chaincode-only">
<h4>Chaincode shim changes (Go chaincode only)<a class="headerlink" href="#chaincode-shim-changes-go-chaincode-only" title="Link to this heading">¶</a></h4>
<p>The v2.x <code class="docutils literal notranslate"><span class="pre">ccenv</span></code> image that is used to build Go chaincodes no longer automatically vendors the Go chaincode shim dependency like the v1.4 <code class="docutils literal notranslate"><span class="pre">ccenv</span></code> image did.
The recommended approach is to vendor the shim in your v1.4 Go chaincode before making upgrades to the peers and channels, since this approach works with both a v1.4.x and v2.x peer. If you are already using an existing tool such as <code class="docutils literal notranslate"><span class="pre">govendor</span></code> you may continue using it to vendor the chaincode shim. Best practice, however, would be to use Go modules to vendor the chaincode shim, as modules are now the de facto standard for dependency management in the Go ecosystem. Note that since Fabric v2.0, chaincode using Go modules without vendored dependencies is also supported. If you do this, you do not need to make any additional changes to your chaincode.</p>
<p>If you did not vendor the shim in your v1.4 chaincode, the old v1.4 chaincode images will still technically work after peer upgrade, but you are in a risky state. If the chaincode image gets deleted from your environment for whatever reason, the next invoke on v2.x peer will try to rebuild the chaincode image and you’ll get an error that the shim cannot be found.</p>
<p>At this point, you have two options:</p>
<ol class="arabic simple">
<li><p>If the entire channel is ready to upgrade chaincode, you can upgrade the chaincode on all peers and on the channel (using either the old or new lifecycle depending on the <code class="docutils literal notranslate"><span class="pre">Application</span></code> capability level you have enabled). The best practice at this point would be to vendor the new Go chaincode shim using modules.</p></li>
<li><p>If the entire channel is not yet ready to upgrade the chaincode, you can use peer environment variables to specify the v1.4 chaincode environment <code class="docutils literal notranslate"><span class="pre">ccenv</span></code> be used to rebuild the chaincode images. This v1.4 <code class="docutils literal notranslate"><span class="pre">ccenv</span></code> should still work with a v2.x peer.</p></li>
</ol>
<p>To eliminate these concerns, the recommendation is to make sure the chaincode shim is vendored and the chaincode is upgraded, prior to upgrading a peer to v2.x.</p>
</section>
<section id="chaincode-logger-go-chaincode-only">
<h4>Chaincode logger (Go chaincode only)<a class="headerlink" href="#chaincode-logger-go-chaincode-only" title="Link to this heading">¶</a></h4>
<p>Support for user chaincodes to utilize the chaincode shim’s logger via <code class="docutils literal notranslate"><span class="pre">NewLogger()</span></code> has been removed. Chaincodes that used the shim’s <code class="docutils literal notranslate"><span class="pre">NewLogger()</span></code> must now shift to their own preferred logging mechanism.</p>
<p>For more information, check out <a class="reference external" href="./logging-control.html#chaincode">Logging control</a>.</p>
</section>
<section id="node-js-v1-4-chaincode">
<h4>Node.js v1.4 Chaincode<a class="headerlink" href="#node-js-v1-4-chaincode" title="Link to this heading">¶</a></h4>
<p>For v1.4 Node.js chaincode libraries, the supported node runtime is v8. Though not formally supported, the v1.4 libraries can work on later versions. For example the Node.js 12 runtime that was used with the Fabric v2.2 <code class="docutils literal notranslate"><span class="pre">fabric-nodeenv</span></code> image.  Fabric v2.4 <code class="docutils literal notranslate"><span class="pre">fabric-nodeenv</span></code> has upgraded to Node.js 16 and Fabric v2.5 <code class="docutils literal notranslate"><span class="pre">fabric-nodeenv</span></code> has upgraded to Node.js 18. It is <em>not possible</em> to run the v1.4 libraries on Node.js 16 or Node.js 18.  Therefore any chaincode written with the v1.4 libraries will need to be updated prior to upgrading to Fabric v2.4 or Fabric v2.5.</p>
<p>Also please note that the v1.4 libraries themselves are not supported, and will no longer get updates. Please migrate to a v2.x Node.js chaincode library.</p>
<p>For detailed information please refer to the <a class="reference external" href="https://github.com/hyperledger/fabric-chaincode-node/blob/main/COMPATIBILITY.md">compatibility</a> document in the <code class="docutils literal notranslate"><span class="pre">fabric-chaincode-node</span></code> repository.</p>
</section>
<section id="chaincode-initialization">
<h4>Chaincode initialization<a class="headerlink" href="#chaincode-initialization" title="Link to this heading">¶</a></h4>
<p>The new chaincode lifecycle does not have an option to automatically call a chaincode <code class="docutils literal notranslate"><span class="pre">Init</span></code> function upon chaincode deployment.
Instead, the new chaincode lifecycle has a mechanism to flag that chaincode initialization is required,
by using the <code class="docutils literal notranslate"><span class="pre">--init-required</span></code> flag, and providing a <code class="docutils literal notranslate"><span class="pre">--isInit</span></code> flag on the <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">chaincode</span> <span class="pre">invoke</span></code> command.
However, in most scenarios it is recommended to embed initialization logic into chaincode rather than use the chaincode lifecycle mechanism.
Chaincode functions often perform checks against existing state, and initialization state can be implemented like any other chaincode state and be checked in subsequent chaincode function calls.
Handling initialization state within chaincode logic rather than with the chaincode lifecycle
mechanism has the benefit that you are not limited to a single initialization function,
rather you are in full control of initialization logic and can call your own
functions that initialize state from an application consistent with how all other application functions are called.</p>
</section>
</section>
<section id="while-upgrading-peer-nodes">
<h3>While upgrading peer nodes<a class="headerlink" href="#while-upgrading-peer-nodes" title="Link to this heading">¶</a></h3>
<section id="peer-databases-upgrade">
<h4>Peer databases upgrade<a class="headerlink" href="#peer-databases-upgrade" title="Link to this heading">¶</a></h4>
<p>For information about how to upgrade peers, check out our documentation on <a class="reference external" href="./upgrading_your_components.html">upgrading components</a>. During the process for <a class="reference external" href="./upgrading_your_components.html#upgrade-the-peers">upgrading your peers</a>, you will need to perform one additional step to upgrade the peer databases. The databases of all peers (which include not just the state database but the history database and other internal databases for the peer) must be rebuilt using the v2.x data format as part of the upgrade to v2.x. To trigger the rebuild, the databases must be dropped before the peer is started. The instructions below utilize the <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">node</span> <span class="pre">upgrade-dbs</span></code> command to drop the local databases managed by the peer and prepare them for upgrade, so that they can be rebuilt the first time the v2.x peer starts. If you are using CouchDB as the state database, the peer has support to automatically drop this database as of v2.2. To leverage the support, you must configure the peer with CouchDB as the state database and start CouchDB before running the <code class="docutils literal notranslate"><span class="pre">upgrade-dbs</span></code> command. In v2.0 and v2.1, the peer does not automatically drop the CouchDB state database; therefore you must drop it yourself.</p>
<p>Follow the commands to upgrade a peer until the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command to launch the new peer container (you can skip the step where you set an <code class="docutils literal notranslate"><span class="pre">IMAGE_TAG</span></code>, since the <code class="docutils literal notranslate"><span class="pre">upgrade-dbs</span></code> command is for the v2.x release of Fabric only, but you will need to set the <code class="docutils literal notranslate"><span class="pre">PEER_CONTAINER</span></code> and <code class="docutils literal notranslate"><span class="pre">LEDGERS_BACKUP</span></code> environment variables). Instead of the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command to launch the peer, run this command instead to drop and prepare the local databases managed by the peer (substitute <code class="docutils literal notranslate"><span class="pre">2.1</span></code> for <code class="docutils literal notranslate"><span class="pre">2.0</span></code> in these commands if you are upgrading to that binary version from the 1.4.x LTS):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker run --rm -v /opt/backup/$PEER_CONTAINER/:/var/hyperledger/production/ \
            -v /opt/msp/:/etc/hyperledger/fabric/msp/ \
            --env-file ./env&lt;name of node&gt;.list \
            --name $PEER_CONTAINER \
            hyperledger/fabric-peer:2.0 peer node upgrade-dbs
</pre></div>
</div>
<p>In v2.0 and v2.1, if you are using CouchDB as the state database, also drop the CouchDB database. This can be done by removing the CouchDB /data volume directory.</p>
<p>Then issue this command to start the peer using the <code class="docutils literal notranslate"><span class="pre">2.0</span></code> tag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker run -d -v /opt/backup/$PEER_CONTAINER/:/var/hyperledger/production/ \
            -v /opt/msp/:/etc/hyperledger/fabric/msp/ \
            --env-file ./env&lt;name of node&gt;.list \
            --name $PEER_CONTAINER \
            hyperledger/fabric-peer:2.0 peer node start
</pre></div>
</div>
<p>The peer will rebuild the databases using the v2.x data format the first time it starts. Because rebuilding the databases can be a lengthy process (several hours, depending on the size of your databases), monitor the peer logs to check the status of the rebuild. Every 1000th block you will see a message like <code class="docutils literal notranslate"><span class="pre">[lockbasedtxmgr]</span> <span class="pre">CommitLostBlock</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">041</span> <span class="pre">Recommitting</span> <span class="pre">block</span> <span class="pre">[1000]</span> <span class="pre">to</span> <span class="pre">state</span> <span class="pre">database</span></code> indicating the rebuild is ongoing.</p>
<p>If the database is not dropped as part of the upgrade process, the peer start will return an error message stating that its databases are in the old format and must be dropped using the <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">node</span> <span class="pre">upgrade-dbs</span></code> command above (or dropped manually if using CouchDB state database). The node will then need to be restarted again.</p>
</section>
</section>
<section id="after-upgrading-nodes">
<h3>After upgrading nodes<a class="headerlink" href="#after-upgrading-nodes" title="Link to this heading">¶</a></h3>
<section id="chaincode-lifecycle">
<h4>Chaincode lifecycle<a class="headerlink" href="#chaincode-lifecycle" title="Link to this heading">¶</a></h4>
<p>The new chaincode lifecycle that debuted in v2.0 allows multiple organizations to agree on how a chaincode will be operated before it can be used on a channel. For more information about the new chaincode lifecycle, check out <a class="reference external" href="./chaincode_lifecycle.html">Fabric chaincode lifecycle</a> concept topic.</p>
<p>It is a best practice to upgrade all of the peers on a channel before enabling the <code class="docutils literal notranslate"><span class="pre">Channel</span></code> and <code class="docutils literal notranslate"><span class="pre">Application</span></code> capabilities that enable the new chaincode lifecycle (the <code class="docutils literal notranslate"><span class="pre">Channel</span></code> capability is not strictly required, but it makes sense to update it at this time). Note that any peers that are not at v2.x will crash after enabling either capability, while any ordering nodes that are not at v2.x will crash after the <code class="docutils literal notranslate"><span class="pre">Channel</span></code> capability has been enabled. This crashing behavior is intentional, as the peer or orderer cannot safely participate in the channel if it does not support the required capabilities.</p>
<p>After the <code class="docutils literal notranslate"><span class="pre">Application</span></code> capability has been updated to <code class="docutils literal notranslate"><span class="pre">V2_0</span></code> on a channel, chaincodes that were deployed using the v1.x chaincode lifecycle will continue to run, and will continue to utilize the same chaincode endorsement policy as before.
However, the next time that you would like to update these chaincodes, you must utilize the v2.x lifecycle procedures to package, install, approve, and commit chaincodes on the channel. This will effectively shift the chaincode from the v1.x lifecycle framework to the v2.x lifecycle framework.
Additionally, any new chaincode deployements must also utilize the v2.x lifecycle procedures to package, install, approve, and commit chaincodes on the channel.
As a result, make sure to be prepared for the new lifecycle before updating the capability.</p>
<p>The new lifecycle defaults to using the endorsement policy configured in the channel config (e.g., a <code class="docutils literal notranslate"><span class="pre">MAJORITY</span></code> of orgs). Therefore this endorsement policy should be added to the channel configuration when enabling capabilities on the channel.</p>
<p>For information about how to edit the relevant channel configurations to enable the new lifecycle by adding an endorsement policy for each organization, check out <a class="reference external" href="./enable_cc_lifecycle.html">Enabling the new chaincode lifecycle</a>.</p>
</section>
<section id="capabilities">
<h4>Capabilities<a class="headerlink" href="#capabilities" title="Link to this heading">¶</a></h4>
<p>The 2.0 release featured three new capabilities.</p>
<ul class="simple">
<li><p><strong>Application</strong> <code class="docutils literal notranslate"><span class="pre">V2_0</span></code>: enables the new chaincode lifecycle as described in <a class="reference external" href="./chaincode_lifecycle.html">Fabric chaincode lifecycle</a> concept topic.</p></li>
<li><p><strong>Channel</strong> <code class="docutils literal notranslate"><span class="pre">V2_0</span></code>: this capability has no changes, but is used for consistency with the application and orderer capability levels.</p></li>
<li><p><strong>Orderer</strong> <code class="docutils literal notranslate"><span class="pre">V2_0</span></code>: controls <code class="docutils literal notranslate"><span class="pre">UseChannelCreationPolicyAsAdmins</span></code>, changing the way that channel creation transactions are validated. When combined with the <code class="docutils literal notranslate"><span class="pre">-baseProfile</span></code> option of configtxgen, values which were previously inherited from the orderer system channel may now be overridden.</p></li>
</ul>
<p>As with any update of the capability levels, make sure to upgrade your peer binaries before updating the <code class="docutils literal notranslate"><span class="pre">Application</span></code> and <code class="docutils literal notranslate"><span class="pre">Channel</span></code> capabilities, and make sure to upgrade your orderer binaries before updating the <code class="docutils literal notranslate"><span class="pre">Orderer</span></code> and <code class="docutils literal notranslate"><span class="pre">Channel</span></code> capabilities.</p>
<p>For information about how to set new capabilities, check out <a class="reference external" href="./updating_capabilities.html">Updating the capability level of a channel</a>.</p>
</section>
<section id="define-ordering-node-endpoint-per-org-recommend">
<h4>Define ordering node endpoint per org (recommend)<a class="headerlink" href="#define-ordering-node-endpoint-per-org-recommend" title="Link to this heading">¶</a></h4>
<p>Starting with version v1.4.2, it was recommended to define orderer endpoints in all channels at the organization level by adding a new <code class="docutils literal notranslate"><span class="pre">OrdererEndpoints</span></code> stanza within the channel configuration of an organization, replacing the global <code class="docutils literal notranslate"><span class="pre">OrdererAddresses</span></code> section of channel configuration. If at least one organization has an ordering service endpoint defined at an organizational level, all orderers and peers will ignore the channel level endpoints when connecting to ordering nodes.</p>
<p>Utilizing organization level orderer endpoints is required when using service discovery with ordering nodes provided by multiple organizations. This allows clients to provide the correct organization TLS certificates.</p>
<p>If your channel configuration does not yet include <code class="docutils literal notranslate"><span class="pre">OrdererEndpoints</span></code> per org, you will need to perform a channel configuration update to add them to the config. First, create a JSON file that includes the new configuration stanza.</p>
<p>In this example, we will create a stanza for a single org called <code class="docutils literal notranslate"><span class="pre">OrdererOrg</span></code>. Note that if you have multiple ordering service organizations, they will all have to be updated to include endpoints. Let’s call our JSON file <code class="docutils literal notranslate"><span class="pre">orglevelEndpoints.json</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;OrdererOrgEndpoint&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;Endpoints&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;mod_policy&quot;</span><span class="p">:</span> <span class="s2">&quot;Admins&quot;</span><span class="p">,</span>
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;addresses&quot;</span><span class="p">:</span> <span class="p">[</span>
                 <span class="s2">&quot;127.0.0.1:30000&quot;</span>
              <span class="p">]</span>
          <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, export the following environment variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CH_NAME</span></code>: the name of the channel being updated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_LOCALMSPID</span></code>: the MSP ID of the organization proposing the channel update. This will be the MSP of one of the orderer organizations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CORE_PEER_MSPCONFIGPATH</span></code>: the absolute path to the MSP representing your organization.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TLS_ROOT_CA</span></code>: the absolute path to the root CA certificate of the organization proposing the channel update.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ORDERER_CONTAINER</span></code>: the name of an ordering node container. When targeting the ordering service, you can target any particular node in the ordering service. Your requests will be forwarded to the leader automatically.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ORGNAME</span></code>: The name of the organization you are currently updating. For example, <code class="docutils literal notranslate"><span class="pre">OrdererOrg</span></code>.</p></li>
</ul>
<p>Once you have set the environment variables, navigate to <a class="reference external" href="./config_update.html#step-1-pull-and-translate-the-config">Step 1: Pull and translate the config</a>.</p>
<p>Then, add the lifecycle organization policy (as listed in <code class="docutils literal notranslate"><span class="pre">orglevelEndpoints.json</span></code>) to a file called <code class="docutils literal notranslate"><span class="pre">modified_config.json</span></code> using this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jq</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&quot;.[0] * {</span><span class="se">\&quot;</span><span class="s2">channel_group</span><span class="se">\&quot;</span><span class="s2">:{</span><span class="se">\&quot;</span><span class="s2">groups</span><span class="se">\&quot;</span><span class="s2">:{</span><span class="se">\&quot;</span><span class="s2">Orderer</span><span class="se">\&quot;</span><span class="s2">: {</span><span class="se">\&quot;</span><span class="s2">groups</span><span class="se">\&quot;</span><span class="s2">: {</span><span class="se">\&quot;</span><span class="s2">$ORGNAME</span><span class="se">\&quot;</span><span class="s2">: {</span><span class="se">\&quot;</span><span class="s2">values</span><span class="se">\&quot;</span><span class="s2">: .[1].$</span><span class="si">{ORGNAME}</span><span class="s2">Endpoint}}}}}}&quot;</span> <span class="n">config</span><span class="o">.</span><span class="n">json</span> <span class="o">./</span><span class="n">orglevelEndpoints</span><span class="o">.</span><span class="n">json</span> <span class="o">&gt;</span> <span class="n">modified_config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Then, follow the steps at <a class="reference external" href="./config_update.html#step-3-re-encode-and-submit-the-config">Step 3: Re-encode and submit the config</a>.</p>
<p>If every ordering service organization performs their own channel edit, they can edit the configuration without needing further signatures (by default, the only signature needed to edit parameters within an organization is an admin of that organization). If a different organization proposes the update, then the organization being edited will need to sign the channel update request.</p>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ -->
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="upgrading_your_components.html" class="btn btn-neutral float-right" title="Upgrading your components" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="upgrade.html" class="btn btn-neutral" title="Upgrading to the latest release" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020-2023.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>